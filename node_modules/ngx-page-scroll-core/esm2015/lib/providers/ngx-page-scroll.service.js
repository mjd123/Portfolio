var PageScrollService_1;
import { __decorate, __metadata, __param } from "tslib";
import { Inject, Injectable, isDevMode } from '@angular/core';
import { PageScrollInstance } from '../page-scroll-instance';
import { defaultPageScrollConfig, NGXPS_CONFIG } from './config.provider';
import * as i0 from "@angular/core";
import * as i1 from "./config.provider";
let PageScrollService = PageScrollService_1 = class PageScrollService {
    constructor(customConfig) {
        this.runningInstances = [];
        this.onInterrupted = {
            report: (event, pageScrollInstance) => {
                if (!pageScrollInstance.pageScrollOptions.interruptible) {
                    // Non-interruptible anyway, so do not stop anything
                    return;
                }
                let shouldStop = true;
                if (event.type === 'keyup') {
                    // Only stop if specific keys have been pressed, for all others don't stop anything
                    if (this.config.interruptKeys.indexOf(event.key) === -1) {
                        // The pressed key is not in the list of interrupting keys
                        shouldStop = false;
                    }
                }
                else if (event.type === 'mousedown') {
                    // For mousedown events we only stop the scroll animation of the mouse has
                    // been clicked inside the scrolling container
                    if (!pageScrollInstance.pageScrollOptions.scrollViews.some(scrollingView => scrollingView.contains(event.target))) {
                        // Mouse clicked an element which is not inside any of the the scrolling containers
                        shouldStop = false;
                    }
                }
                if (shouldStop) {
                    this.stopAll(pageScrollInstance.pageScrollOptions.namespace);
                }
            },
        };
        this.config = Object.assign(Object.assign({}, defaultPageScrollConfig), customConfig);
        if (PageScrollService_1.instanceCounter > 0 &&
            (this.config._logLevel >= 2 || (this.config._logLevel >= 1 && isDevMode()))) {
            console.warn('An instance of PageScrollService already exists, usually ' +
                'including one provider should be enough, so double check.');
        }
        PageScrollService_1.instanceCounter++;
    }
    stopInternal(interrupted, pageScrollInstance) {
        const index = this.runningInstances.indexOf(pageScrollInstance);
        if (index >= 0) {
            this.runningInstances.splice(index, 1);
        }
        if (pageScrollInstance.interruptListenersAttached) {
            pageScrollInstance.detachInterruptListeners();
        }
        if (pageScrollInstance.timer) {
            // Clear/Stop the timer
            clearInterval(pageScrollInstance.timer);
            // Clear the reference to this timer
            pageScrollInstance.timer = undefined;
            pageScrollInstance.fireEvent(!interrupted);
            return true;
        }
        return false;
    }
    create(options) {
        return new PageScrollInstance(Object.assign(Object.assign({}, this.config), options));
    }
    /**
     * Start a scroll animation. All properties of the animation are stored in the given {@link PageScrollInstance} object.
     *
     * This is the core functionality of the whole library.
     */
    // tslint:disable-next-line:cyclomatic-complexity
    start(pageScrollInstance) {
        // Merge the default options in the pageScrollInstance options
        pageScrollInstance.pageScrollOptions = Object.assign(Object.assign({}, this.config), pageScrollInstance.pageScrollOptions);
        // Stop all possibly running scroll animations in the same namespace
        this.stopAll(pageScrollInstance.pageScrollOptions.namespace);
        if (pageScrollInstance.pageScrollOptions.scrollViews === null || pageScrollInstance.pageScrollOptions.scrollViews.length === 0) {
            // No scrollViews specified, thus we can't animate anything
            if (this.config._logLevel >= 2 || (this.config._logLevel >= 1 && isDevMode())) {
                console.warn('No scrollViews specified, thus ngx-page-scroll does not know which DOM elements to scroll');
            }
            return;
        }
        let startScrollPositionFound = false;
        let scrollRange = pageScrollInstance.getScrollClientPropertyValue(pageScrollInstance.pageScrollOptions.scrollViews[0]);
        // Reset start scroll position to 0. If any of the scrollViews has a different one, it will be extracted next
        pageScrollInstance.startScrollPosition = 0;
        // Get the start scroll position from the scrollViews (e.g. if the user already scrolled down the content)
        pageScrollInstance.pageScrollOptions.scrollViews.forEach(scrollingView => {
            if (scrollingView === undefined || scrollingView === null) {
                return;
            }
            // Get the scrollTop or scrollLeft value of the first scrollingView that returns a value for its "scrollTop"
            // or "scrollLeft" property that is not undefined and unequal to 0
            const scrollPosition = pageScrollInstance.getScrollPropertyValue(scrollingView);
            if (!startScrollPositionFound && scrollPosition) {
                // We found a scrollingView that does not have scrollTop or scrollLeft 0
                // Return the scroll position value, as this will be our startScrollPosition
                pageScrollInstance.startScrollPosition = scrollPosition;
                startScrollPositionFound = true;
                // Remember te scrollRange of this scrollingView
                scrollRange = pageScrollInstance.getScrollClientPropertyValue(scrollingView);
            }
        });
        const pageScrollOffset = pageScrollInstance.getCurrentOffset();
        // Calculate the target position that the scroll animation should go to
        const scrollTargetPosition = pageScrollInstance.extractScrollTargetPosition();
        pageScrollInstance.targetScrollPosition = Math.round((pageScrollInstance.pageScrollOptions.verticalScrolling ? scrollTargetPosition.top : scrollTargetPosition.left) - pageScrollOffset);
        // Calculate the distance we need to go in total
        pageScrollInstance.distanceToScroll = pageScrollInstance.targetScrollPosition - pageScrollInstance.startScrollPosition;
        if (isNaN(pageScrollInstance.distanceToScroll)) {
            // We weren't able to find the target position, maybe the element does not exist?
            if (this.config._logLevel >= 2 || (this.config._logLevel >= 1 && isDevMode())) {
                console.log('Scrolling not possible, as we can\'t find the specified target');
            }
            pageScrollInstance.fireEvent(false);
            return;
        }
        // We're at the final destination already
        // OR we need to scroll down but are already at the end
        // OR we need to scroll up but are at the top already
        const allReadyAtDestination = Math.abs(pageScrollInstance.distanceToScroll) < pageScrollInstance.pageScrollOptions._minScrollDistance;
        // Check how long we need to scroll if a speed option is given
        // Default executionDuration is the specified duration
        pageScrollInstance.executionDuration = pageScrollInstance.pageScrollOptions.duration;
        // Maybe we need to pay attention to the speed option?
        if ((pageScrollInstance.pageScrollOptions.speed !== undefined && pageScrollInstance.pageScrollOptions.speed !== null) &&
            (pageScrollInstance.pageScrollOptions.duration === undefined || pageScrollInstance.pageScrollOptions.duration === null)) {
            // Speed option is set and no duration => calculate duration based on speed and scroll distance
            pageScrollInstance.executionDuration =
                Math.abs(pageScrollInstance.distanceToScroll) / pageScrollInstance.pageScrollOptions.speed * 1000;
        }
        // We should go there directly, as our "animation" would have one big step
        // only anyway and this way we save the interval stuff
        const tooShortInterval = pageScrollInstance.executionDuration <= pageScrollInstance.pageScrollOptions._interval;
        if (allReadyAtDestination || tooShortInterval) {
            if (this.config._logLevel >= 2 || (this.config._logLevel >= 1 && isDevMode())) {
                if (allReadyAtDestination) {
                    console.log('Scrolling not possible, as we can\'t get any closer to the destination');
                }
                else {
                    console.log('Scroll duration shorter that interval length, jumping to target');
                }
            }
            pageScrollInstance.setScrollPosition(pageScrollInstance.targetScrollPosition);
            pageScrollInstance.fireEvent(true);
            return;
        }
        if (!pageScrollInstance.pageScrollOptions.scrollInView) {
            const alreadyInView = pageScrollInstance.targetScrollPosition > pageScrollInstance.startScrollPosition &&
                pageScrollInstance.targetScrollPosition <= pageScrollInstance.startScrollPosition + scrollRange;
            if (alreadyInView) {
                if (this.config._logLevel >= 2 || (this.config._logLevel >= 1 && isDevMode())) {
                    console.log('Not scrolling, as target already in view');
                }
                pageScrollInstance.fireEvent(true);
                return;
            }
        }
        // Register the interrupt listeners if we want an interruptible scroll animation
        if (pageScrollInstance.pageScrollOptions.interruptible) {
            pageScrollInstance.attachInterruptListeners(this.onInterrupted);
        }
        // Let's get started, get the start time...
        pageScrollInstance.startTime = new Date().getTime();
        // .. and calculate the end time (when we need to finish at last)
        pageScrollInstance.endTime = pageScrollInstance.startTime + pageScrollInstance.executionDuration;
        pageScrollInstance.timer = setInterval((_pageScrollInstance) => {
            // Take the current time
            const currentTime = new Date().getTime();
            // Determine the new scroll position
            let newScrollPosition;
            let stopNow = false;
            if (_pageScrollInstance.endTime <= currentTime) {
                // We're over the time already, so go the targetScrollPosition (aka destination)
                newScrollPosition = _pageScrollInstance.targetScrollPosition;
                stopNow = true;
            }
            else {
                // Calculate the scroll position based on the current time using the easing function
                newScrollPosition = Math.round(_pageScrollInstance.pageScrollOptions.easingLogic(currentTime - _pageScrollInstance.startTime, _pageScrollInstance.startScrollPosition, _pageScrollInstance.distanceToScroll, _pageScrollInstance.executionDuration));
            }
            if (this.config._logLevel >= 5 && isDevMode()) {
                console.warn('Scroll Position: ' + newScrollPosition);
            }
            // Set the new scrollPosition to all scrollViews elements
            if (!_pageScrollInstance.setScrollPosition(newScrollPosition)) {
                // Setting the new scrollTop/scrollLeft value failed for all ScrollViews
                // early stop the scroll animation to save resources
                stopNow = true;
            }
            // At the end do the internal stop maintenance and fire the pageScrollFinish event
            // (otherwise the event might arrive at "too early")
            if (stopNow) {
                this.stopInternal(false, _pageScrollInstance);
            }
        }, this.config._interval, pageScrollInstance);
        // Register the instance as running one
        this.runningInstances.push(pageScrollInstance);
    }
    scroll(options) {
        this.start(this.create(options));
    }
    /**
     * Stop all running scroll animations. Optionally limit to stop only the ones of specific namespace.
     */
    stopAll(namespace) {
        if (this.runningInstances.length > 0) {
            let stoppedSome = false;
            for (let i = 0; i < this.runningInstances.length; ++i) {
                const pageScrollInstance = this.runningInstances[i];
                if (!namespace || pageScrollInstance.pageScrollOptions.namespace === namespace) {
                    stoppedSome = true;
                    this.stopInternal(true, pageScrollInstance);
                    // Decrease the counter, as we removed an item from the array we iterate over
                    i--;
                }
            }
            return stoppedSome;
        }
        return false;
    }
    stop(pageScrollInstance) {
        return this.stopInternal(true, pageScrollInstance);
    }
};
PageScrollService.instanceCounter = 0;
PageScrollService.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [NGXPS_CONFIG,] }] }
];
PageScrollService.ɵprov = i0.ɵɵdefineInjectable({ factory: function PageScrollService_Factory() { return new PageScrollService(i0.ɵɵinject(i1.NGXPS_CONFIG)); }, token: PageScrollService, providedIn: "root" });
PageScrollService = PageScrollService_1 = __decorate([
    Injectable({
        providedIn: 'root',
    }),
    __param(0, Inject(NGXPS_CONFIG)),
    __metadata("design:paramtypes", [Object])
], PageScrollService);
export { PageScrollService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXBhZ2Utc2Nyb2xsLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtcGFnZS1zY3JvbGwtY29yZS8iLCJzb3VyY2VzIjpbImxpYi9wcm92aWRlcnMvbmd4LXBhZ2Utc2Nyb2xsLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHOUQsT0FBTyxFQUFxQixrQkFBa0IsRUFBcUIsTUFBTSx5QkFBeUIsQ0FBQztBQUNuRyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsWUFBWSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7OztBQUsxRSxJQUFhLGlCQUFpQix5QkFBOUIsTUFBYSxpQkFBaUI7SUF1UTVCLFlBQWtDLFlBQThCO1FBbFF4RCxxQkFBZ0IsR0FBeUIsRUFBRSxDQUFDO1FBRTVDLGtCQUFhLEdBQXNCO1lBQ3pDLE1BQU0sRUFBRSxDQUFDLEtBQVksRUFBRSxrQkFBc0MsRUFBUSxFQUFFO2dCQUNyRSxJQUFJLENBQUMsa0JBQWtCLENBQUMsaUJBQWlCLENBQUMsYUFBYSxFQUFFO29CQUN2RCxvREFBb0Q7b0JBQ3BELE9BQU87aUJBQ1I7Z0JBRUQsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDO2dCQUV0QixJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssT0FBTyxFQUFFO29CQUMxQixtRkFBbUY7b0JBQ25GLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFpQixLQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7d0JBQ3hFLDBEQUEwRDt3QkFDMUQsVUFBVSxHQUFHLEtBQUssQ0FBQztxQkFDcEI7aUJBQ0Y7cUJBQU0sSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLFdBQVcsRUFBRTtvQkFDckMsMEVBQTBFO29CQUMxRSw4Q0FBOEM7b0JBQzlDLElBQUksQ0FBQyxrQkFBa0IsQ0FB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QUFDO2dCQUNwRCxJQUFJLENBQUMsU0FBUyxJQUFJLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDLFNBQVMsS0FBSyxTQUFTLEVBQUU7b0JBQzlFLFdBQVcsR0FBRyxJQUFJLENBQUM7b0JBQ25CLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLGtCQUFrQixDQUFDLENBQUM7b0JBQzVDLDZFQUE2RTtvQkFDN0UsQ0FBQyxFQUFFLENBQUM7aUJBQ0w7YUFDRjtZQUVELE9BQU8sV0FBVyxDQUFDO1NBQ3BCO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRU0sSUFBSSxDQUFDLGtCQUFzQztRQUNoRCxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLGtCQUFrQixDQUFDLENBQUM7SUFDckQsQ0FBQztDQVlGLENBQUE7QUFoUmdCLGlDQUFlLEdBQUcsQ0FBQyxDQUFDOzs0Q0FzUXRCLE1BQU0sU0FBQyxZQUFZOzs7QUF2UXJCLGlCQUFpQjtJQUg3QixVQUFVLENBQUM7UUFDVixVQUFVLEVBQUUsTUFBTTtLQUNuQixDQUFDO0lBd1FhLFdBQUEsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFBOztHQXZRdEIsaUJBQWlCLENBaVI3QjtTQWpSWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUsIGlzRGV2TW9kZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBQYWdlU2Nyb2xsQ29uZmlnIH0gZnJvbSAnLi4vdHlwZXMvcGFnZS1zY3JvbGwuY29uZmlnJztcbmltcG9ydCB7IEludGVycnVwdFJlcG9ydGVyLCBQYWdlU2Nyb2xsSW5zdGFuY2UsIFBhZ2VTY3JvbGxPcHRpb25zIH0gZnJvbSAnLi4vcGFnZS1zY3JvbGwtaW5zdGFuY2UnO1xuaW1wb3J0IHsgZGVmYXVsdFBhZ2VTY3JvbGxDb25maWcsIE5HWFBTX0NPTkZJRyB9IGZyb20gJy4vY29uZmlnLnByb3ZpZGVyJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCcsXG59KVxuZXhwb3J0IGNsYXNzIFBhZ2VTY3JvbGxTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2VDb3VudGVyID0gMDtcblxuICBwcml2YXRlIHJlYWRvbmx5IGNvbmZpZzogUGFnZVNjcm9sbENvbmZpZztcblxuICBwcml2YXRlIHJ1bm5pbmdJbnN0YW5jZXM6IFBhZ2VTY3JvbGxJbnN0YW5jZVtdID0gW107XG5cbiAgcHJpdmF0ZSBvbkludGVycnVwdGVkOiBJbnRlcnJ1cHRSZXBvcnRlciA9IHtcbiAgICByZXBvcnQ6IChldmVudDogRXZlbnQsIHBhZ2VTY3JvbGxJbnN0YW5jZTogUGFnZVNjcm9sbEluc3RhbmNlKTogdm9pZCA9PiB7XG4gICAgICBpZiAoIXBhZ2VTY3JvbGxJbnN0YW5jZS5wYWdlU2Nyb2xsT3B0aW9ucy5pbnRlcnJ1cHRpYmxlKSB7XG4gICAgICAgIC8vIE5vbi1pbnRlcnJ1cHRpYmxlIGFueXdheSwgc28gZG8gbm90IHN0b3AgYW55dGhpbmdcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBsZXQgc2hvdWxkU3RvcCA9IHRydWU7XG5cbiAgICAgIGlmIChldmVudC50eXBlID09PSAna2V5dXAnKSB7XG4gICAgICAgIC8vIE9ubHkgc3RvcCBpZiBzcGVjaWZpYyBrZXlzIGhhdmUgYmVlbiBwcmVzc2VkLCBmb3IgYWxsIG90aGVycyBkb24ndCBzdG9wIGFueXRoaW5nXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5pbnRlcnJ1cHRLZXlzLmluZGV4T2YoKDxLZXlib2FyZEV2ZW50PmV2ZW50KS5rZXkpID09PSAtMSkge1xuICAgICAgICAgIC8vIFRoZSBwcmVzc2VkIGtleSBpcyBub3QgaW4gdGhlIGxpc3Qgb2YgaW50ZXJydXB0aW5nIGtleXNcbiAgICAgICAgICBzaG91bGRTdG9wID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gJ21vdXNlZG93bicpIHtcbiAgICAgICAgLy8gRm9yIG1vdXNlZG93biBldmVudHMgd2Ugb25seSBzdG9wIHRoZSBzY3JvbGwgYW5pbWF0aW9uIG9mIHRoZSBtb3VzZSBoYXNcbiAgICAgICAgLy8gYmVlbiBjbGlja2VkIGluc2lkZSB0aGUgc2Nyb2xsaW5nIGNvbnRhaW5lclxuICAgICAgICBpZiAoIXBhZ2VTY3JvbGxJbnN0YW5jZS5wYWdlU2Nyb2xsT3B0aW9ucy5zY3JvbGxWaWV3cy5zb21lKHNjcm9sbGluZ1ZpZXcgPT4gc2Nyb2xsaW5nVmlldy5jb250YWlucyhldmVudC50YXJnZXQgYXMgTm9kZSkpKSB7XG4gICAgICAgICAgLy8gTW91c2UgY2xpY2tlZCBhbiBlbGVtZW50IHdoaWNoIGlzIG5vdCBpbnNpZGUgYW55IG9mIHRoZSB0aGUgc2Nyb2xsaW5nIGNvbnRhaW5lcnNcbiAgICAgICAgICBzaG91bGRTdG9wID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHNob3VsZFN0b3ApIHtcbiAgICAgICAgdGhpcy5zdG9wQWxsKHBhZ2VTY3JvbGxJbnN0YW5jZS5wYWdlU2Nyb2xsT3B0aW9ucy5uYW1lc3BhY2UpO1xuICAgICAgfVxuICAgIH0sXG4gIH07XG5cbiAgcHJpdmF0ZSBzdG9wSW50ZXJuYWwoaW50ZXJydXB0ZWQ6IGJvb2xlYW4sIHBhZ2VTY3JvbGxJbnN0YW5jZTogUGFnZVNjcm9sbEluc3RhbmNlKTogYm9vbGVhbiB7XG4gICAgY29uc3QgaW5kZXg6IG51bWJlciA9IHRoaXMucnVubmluZ0luc3RhbmNlcy5pbmRleE9mKHBhZ2VTY3JvbGxJbnN0YW5jZSk7XG4gICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgIHRoaXMucnVubmluZ0luc3RhbmNlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIH1cblxuICAgIGlmIChwYWdlU2Nyb2xsSW5zdGFuY2UuaW50ZXJydXB0TGlzdGVuZXJzQXR0YWNoZWQpIHtcbiAgICAgIHBhZ2VTY3JvbGxJbnN0YW5jZS5kZXRhY2hJbnRlcnJ1cHRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBpZiAocGFnZVNjcm9sbEluc3RhbmNlLnRpbWVyKSB7XG4gICAgICAvLyBDbGVhci9TdG9wIHRoZSB0aW1lclxuICAgICAgY2xlYXJJbnRlcnZhbChwYWdlU2Nyb2xsSW5zdGFuY2UudGltZXIpO1xuICAgICAgLy8gQ2xlYXIgdGhlIHJlZmVyZW5jZSB0byB0aGlzIHRpbWVyXG4gICAgICBwYWdlU2Nyb2xsSW5zdGFuY2UudGltZXIgPSB1bmRlZmluZWQ7XG4gICAgICBwYWdlU2Nyb2xsSW5zdGFuY2UuZmlyZUV2ZW50KCFpbnRlcnJ1cHRlZCk7XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGUob3B0aW9uczogUGFnZVNjcm9sbE9wdGlvbnMpOiBQYWdlU2Nyb2xsSW5zdGFuY2Uge1xuICAgIHJldHVybiBuZXcgUGFnZVNjcm9sbEluc3RhbmNlKHsuLi50aGlzLmNvbmZpZywgLi4ub3B0aW9uc30gYXMgUGFnZVNjcm9sbE9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IGEgc2Nyb2xsIGFuaW1hdGlvbi4gQWxsIHByb3BlcnRpZXMgb2YgdGhlIGFuaW1hdGlvbiBhcmUgc3RvcmVkIGluIHRoZSBnaXZlbiB7QGxpbmsgUGFnZVNjcm9sbEluc3RhbmNlfSBvYmplY3QuXG4gICAqXG4gICAqIFRoaXMgaXMgdGhlIGNvcmUgZnVuY3Rpb25hbGl0eSBvZiB0aGUgd2hvbGUgbGlicmFyeS5cbiAgICovXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpjeWNsb21hdGljLWNvbXBsZXhpdHlcbiAgcHVibGljIHN0YXJ0KHBhZ2VTY3JvbGxJbnN0YW5jZTogUGFnZVNjcm9sbEluc3RhbmNlKTogdm9pZCB7XG4gICAgLy8gTWVyZ2UgdGhlIGRlZmF1bHQgb3B0aW9ucyBpbiB0aGUgcGFnZVNjcm9sbEluc3RhbmNlIG9wdGlvbnNcbiAgICBwYWdlU2Nyb2xsSW5zdGFuY2UucGFnZVNjcm9sbE9wdGlvbnMgPSB7Li4udGhpcy5jb25maWcsIC4uLnBhZ2VTY3JvbGxJbnN0YW5jZS5wYWdlU2Nyb2xsT3B0aW9uc30gYXMgUGFnZVNjcm9sbE9wdGlvbnM7XG5cbiAgICAvLyBTdG9wIGFsbCBwb3NzaWJseSBydW5uaW5nIHNjcm9sbCBhbmltYXRpb25zIGluIHRoZSBzYW1lIG5hbWVzcGFjZVxuICAgIHRoaXMuc3RvcEFsbChwYWdlU2Nyb2xsSW5zdGFuY2UucGFnZVNjcm9sbE9wdGlvbnMubmFtZXNwYWNlKTtcblxuICAgIGlmIChwYWdlU2Nyb2xsSW5zdGFuY2UucGFnZVNjcm9sbE9wdGlvbnMuc2Nyb2xsVmlld3MgPT09IG51bGwgfHwgcGFnZVNjcm9sbEluc3RhbmNlLnBhZ2VTY3JvbGxPcHRpb25zLnNjcm9sbFZpZXdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgLy8gTm8gc2Nyb2xsVmlld3Mgc3BlY2lmaWVkLCB0aHVzIHdlIGNhbid0IGFuaW1hdGUgYW55dGhpbmdcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5fbG9nTGV2ZWwgPj0gMiB8fCAodGhpcy5jb25maWcuX2xvZ0xldmVsID49IDEgJiYgaXNEZXZNb2RlKCkpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignTm8gc2Nyb2xsVmlld3Mgc3BlY2lmaWVkLCB0aHVzIG5neC1wYWdlLXNjcm9sbCBkb2VzIG5vdCBrbm93IHdoaWNoIERPTSBlbGVtZW50cyB0byBzY3JvbGwnKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBzdGFydFNjcm9sbFBvc2l0aW9uRm91bmQgPSBmYWxzZTtcbiAgICBsZXQgc2Nyb2xsUmFuZ2UgPSBwYWdlU2Nyb2xsSW5zdGFuY2UuZ2V0U2Nyb2xsQ2xpZW50UHJvcGVydHlWYWx1ZShwYWdlU2Nyb2xsSW5zdGFuY2UucGFnZVNjcm9sbE9wdGlvbnMuc2Nyb2xsVmlld3NbMF0pO1xuICAgIC8vIFJlc2V0IHN0YXJ0IHNjcm9sbCBwb3NpdGlvbiB0byAwLiBJZiBhbnkgb2YgdGhlIHNjcm9sbFZpZXdzIGhhcyBhIGRpZmZlcmVudCBvbmUsIGl0IHdpbGwgYmUgZXh0cmFjdGVkIG5leHRcbiAgICBwYWdlU2Nyb2xsSW5zdGFuY2Uuc3RhcnRTY3JvbGxQb3NpdGlvbiA9IDA7XG5cbiAgICAvLyBHZXQgdGhlIHN0YXJ0IHNjcm9sbCBwb3NpdGlvbiBmcm9tIHRoZSBzY3JvbGxWaWV3cyAoZS5nLiBpZiB0aGUgdXNlciBhbHJlYWR5IHNjcm9sbGVkIGRvd24gdGhlIGNvbnRlbnQpXG4gICAgcGFnZVNjcm9sbEluc3RhbmNlLnBhZ2VTY3JvbGxPcHRpb25zLnNjcm9sbFZpZXdzLmZvckVhY2goc2Nyb2xsaW5nVmlldyA9PiB7XG4gICAgICBpZiAoc2Nyb2xsaW5nVmlldyA9PT0gdW5kZWZpbmVkIHx8IHNjcm9sbGluZ1ZpZXcgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy8gR2V0IHRoZSBzY3JvbGxUb3Agb3Igc2Nyb2xsTGVmdCB2YWx1ZSBvZiB0aGUgZmlyc3Qgc2Nyb2xsaW5nVmlldyB0aGF0IHJldHVybnMgYSB2YWx1ZSBmb3IgaXRzIFwic2Nyb2xsVG9wXCJcbiAgICAgIC8vIG9yIFwic2Nyb2xsTGVmdFwiIHByb3BlcnR5IHRoYXQgaXMgbm90IHVuZGVmaW5lZCBhbmQgdW5lcXVhbCB0byAwXG5cbiAgICAgIGNvbnN0IHNjcm9sbFBvc2l0aW9uID0gcGFnZVNjcm9sbEluc3RhbmNlLmdldFNjcm9sbFByb3BlcnR5VmFsdWUoc2Nyb2xsaW5nVmlldyk7XG4gICAgICBpZiAoIXN0YXJ0U2Nyb2xsUG9zaXRpb25Gb3VuZCAmJiBzY3JvbGxQb3NpdGlvbikge1xuICAgICAgICAvLyBXZSBmb3VuZCBhIHNjcm9sbGluZ1ZpZXcgdGhhdCBkb2VzIG5vdCBoYXZlIHNjcm9sbFRvcCBvciBzY3JvbGxMZWZ0IDBcblxuICAgICAgICAvLyBSZXR1cm4gdGhlIHNjcm9sbCBwb3NpdGlvbiB2YWx1ZSwgYXMgdGhpcyB3aWxsIGJlIG91ciBzdGFydFNjcm9sbFBvc2l0aW9uXG4gICAgICAgIHBhZ2VTY3JvbGxJbnN0YW5jZS5zdGFydFNjcm9sbFBvc2l0aW9uID0gc2Nyb2xsUG9zaXRpb247XG4gICAgICAgIHN0YXJ0U2Nyb2xsUG9zaXRpb25Gb3VuZCA9IHRydWU7XG5cbiAgICAgICAgLy8gUmVtZW1iZXIgdGUgc2Nyb2xsUmFuZ2Ugb2YgdGhpcyBzY3JvbGxpbmdWaWV3XG4gICAgICAgIHNjcm9sbFJhbmdlID0gcGFnZVNjcm9sbEluc3RhbmNlLmdldFNjcm9sbENsaWVudFByb3BlcnR5VmFsdWUoc2Nyb2xsaW5nVmlldyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBwYWdlU2Nyb2xsT2Zmc2V0ID0gcGFnZVNjcm9sbEluc3RhbmNlLmdldEN1cnJlbnRPZmZzZXQoKTtcblxuICAgIC8vIENhbGN1bGF0ZSB0aGUgdGFyZ2V0IHBvc2l0aW9uIHRoYXQgdGhlIHNjcm9sbCBhbmltYXRpb24gc2hvdWxkIGdvIHRvXG5cbiAgICBjb25zdCBzY3JvbGxUYXJnZXRQb3NpdGlvbiA9IHBhZ2VTY3JvbGxJbnN0YW5jZS5leHRyYWN0U2Nyb2xsVGFyZ2V0UG9zaXRpb24oKTtcbiAgICBwYWdlU2Nyb2xsSW5zdGFuY2UudGFyZ2V0U2Nyb2xsUG9zaXRpb24gPSBNYXRoLnJvdW5kKFxuICAgICAgKHBhZ2VTY3JvbGxJbnN0YW5jZS5wYWdlU2Nyb2xsT3B0aW9ucy52ZXJ0aWNhbFNjcm9sbGluZyA/IHNjcm9sbFRhcmdldFBvc2l0aW9uLnRvcCA6IHNjcm9sbFRhcmdldFBvc2l0aW9uLmxlZnQpIC0gcGFnZVNjcm9sbE9mZnNldCk7XG5cbiAgICAvLyBDYWxjdWxhdGUgdGhlIGRpc3RhbmNlIHdlIG5lZWQgdG8gZ28gaW4gdG90YWxcbiAgICBwYWdlU2Nyb2xsSW5zdGFuY2UuZGlzdGFuY2VUb1Njcm9sbCA9IHBhZ2VTY3JvbGxJbnN0YW5jZS50YXJnZXRTY3JvbGxQb3NpdGlvbiAtIHBhZ2VTY3JvbGxJbnN0YW5jZS5zdGFydFNjcm9sbFBvc2l0aW9uO1xuXG4gICAgaWYgKGlzTmFOKHBhZ2VTY3JvbGxJbnN0YW5jZS5kaXN0YW5jZVRvU2Nyb2xsKSkge1xuICAgICAgLy8gV2Ugd2VyZW4ndCBhYmxlIHRvIGZpbmQgdGhlIHRhcmdldCBwb3NpdGlvbiwgbWF5YmUgdGhlIGVsZW1lbnQgZG9lcyBub3QgZXhpc3Q/XG5cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5fbG9nTGV2ZWwgPj0gMiB8fCAodGhpcy5jb25maWcuX2xvZ0xldmVsID49IDEgJiYgaXNEZXZNb2RlKCkpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdTY3JvbGxpbmcgbm90IHBvc3NpYmxlLCBhcyB3ZSBjYW5cXCd0IGZpbmQgdGhlIHNwZWNpZmllZCB0YXJnZXQnKTtcbiAgICAgIH1cbiAgICAgIHBhZ2VTY3JvbGxJbnN0YW5jZS5maXJlRXZlbnQoZmFsc2UpO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gV2UncmUgYXQgdGhlIGZpbmFsIGRlc3RpbmF0aW9uIGFscmVhZHlcbiAgICAvLyBPUiB3ZSBuZWVkIHRvIHNjcm9sbCBkb3duIGJ1dCBhcmUgYWxyZWFkeSBhdCB0aGUgZW5kXG4gICAgLy8gT1Igd2UgbmVlZCB0byBzY3JvbGwgdXAgYnV0IGFyZSBhdCB0aGUgdG9wIGFscmVhZHlcbiAgICBjb25zdCBhbGxSZWFkeUF0RGVzdGluYXRpb24gPSBNYXRoLmFicyhwYWdlU2Nyb2xsSW5zdGFuY2UuZGlzdGFuY2VUb1Njcm9sbCkgPCBwYWdlU2Nyb2xsSW5zdGFuY2UucGFnZVNjcm9sbE9wdGlvbnMuX21pblNjcm9sbERpc3RhbmNlO1xuXG4gICAgLy8gQ2hlY2sgaG93IGxvbmcgd2UgbmVlZCB0byBzY3JvbGwgaWYgYSBzcGVlZCBvcHRpb24gaXMgZ2l2ZW5cbiAgICAvLyBEZWZhdWx0IGV4ZWN1dGlvbkR1cmF0aW9uIGlzIHRoZSBzcGVjaWZpZWQgZHVyYXRpb25cbiAgICBwYWdlU2Nyb2xsSW5zdGFuY2UuZXhlY3V0aW9uRHVyYXRpb24gPSBwYWdlU2Nyb2xsSW5zdGFuY2UucGFnZVNjcm9sbE9wdGlvbnMuZHVyYXRpb247XG4gICAgLy8gTWF5YmUgd2UgbmVlZCB0byBwYXkgYXR0ZW50aW9uIHRvIHRoZSBzcGVlZCBvcHRpb24/XG4gICAgaWYgKChwYWdlU2Nyb2xsSW5zdGFuY2UucGFnZVNjcm9sbE9wdGlvbnMuc3BlZWQgIT09IHVuZGVmaW5lZCAmJiBwYWdlU2Nyb2xsSW5zdGFuY2UucGFnZVNjcm9sbE9wdGlvbnMuc3BlZWQgIT09IG51bGwpICYmXG4gICAgICAocGFnZVNjcm9sbEluc3RhbmNlLnBhZ2VTY3JvbGxPcHRpb25zLmR1cmF0aW9uID09PSB1bmRlZmluZWQgfHwgcGFnZVNjcm9sbEluc3RhbmNlLnBhZ2VTY3JvbGxPcHRpb25zLmR1cmF0aW9uID09PSBudWxsKSkge1xuICAgICAgLy8gU3BlZWQgb3B0aW9uIGlzIHNldCBhbmQgbm8gZHVyYXRpb24gPT4gY2FsY3VsYXRlIGR1cmF0aW9uIGJhc2VkIG9uIHNwZWVkIGFuZCBzY3JvbGwgZGlzdGFuY2VcbiAgICAgIHBhZ2VTY3JvbGxJbnN0YW5jZS5leGVjdXRpb25EdXJhdGlvbiA9XG4gICAgICAgIE1hdGguYWJzKHBhZ2VTY3JvbGxJbnN0YW5jZS5kaXN0YW5jZVRvU2Nyb2xsKSAvIHBhZ2VTY3JvbGxJbnN0YW5jZS5wYWdlU2Nyb2xsT3B0aW9ucy5zcGVlZCAqIDEwMDA7XG4gICAgfVxuXG4gICAgLy8gV2Ugc2hvdWxkIGdvIHRoZXJlIGRpcmVjdGx5LCBhcyBvdXIgXCJhbmltYXRpb25cIiB3b3VsZCBoYXZlIG9uZSBiaWcgc3RlcFxuICAgIC8vIG9ubHkgYW55d2F5IGFuZCB0aGlzIHdheSB3ZSBzYXZlIHRoZSBpbnRlcnZhbCBzdHVmZlxuICAgIGNvbnN0IHRvb1Nob3J0SW50ZXJ2YWwgPSBwYWdlU2Nyb2xsSW5zdGFuY2UuZXhlY3V0aW9uRHVyYXRpb24gPD0gcGFnZVNjcm9sbEluc3RhbmNlLnBhZ2VTY3JvbGxPcHRpb25zLl9pbnRlcnZhbDtcblxuICAgIGlmIChhbGxSZWFkeUF0RGVzdGluYXRpb24gfHwgdG9vU2hvcnRJbnRlcnZhbCkge1xuICAgICAgaWYgKHRoaXMuY29uZmlnLl9sb2dMZXZlbCA+PSAyIHx8ICh0aGlzLmNvbmZpZy5fbG9nTGV2ZWwgPj0gMSAmJiBpc0Rldk1vZGUoKSkpIHtcbiAgICAgICAgaWYgKGFsbFJlYWR5QXREZXN0aW5hdGlvbikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdTY3JvbGxpbmcgbm90IHBvc3NpYmxlLCBhcyB3ZSBjYW5cXCd0IGdldCBhbnkgY2xvc2VyIHRvIHRoZSBkZXN0aW5hdGlvbicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdTY3JvbGwgZHVyYXRpb24gc2hvcnRlciB0aGF0IGludGVydmFsIGxlbmd0aCwganVtcGluZyB0byB0YXJnZXQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcGFnZVNjcm9sbEluc3RhbmNlLnNldFNjcm9sbFBvc2l0aW9uKHBhZ2VTY3JvbGxJbnN0YW5jZS50YXJnZXRTY3JvbGxQb3NpdGlvbik7XG4gICAgICBwYWdlU2Nyb2xsSW5zdGFuY2UuZmlyZUV2ZW50KHRydWUpO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFwYWdlU2Nyb2xsSW5zdGFuY2UucGFnZVNjcm9sbE9wdGlvbnMuc2Nyb2xsSW5WaWV3KSB7XG4gICAgICBjb25zdCBhbHJlYWR5SW5WaWV3ID0gcGFnZVNjcm9sbEluc3RhbmNlLnRhcmdldFNjcm9sbFBvc2l0aW9uID4gcGFnZVNjcm9sbEluc3RhbmNlLnN0YXJ0U2Nyb2xsUG9zaXRpb24gJiZcbiAgICAgICAgcGFnZVNjcm9sbEluc3RhbmNlLnRhcmdldFNjcm9sbFBvc2l0aW9uIDw9IHBhZ2VTY3JvbGxJbnN0YW5jZS5zdGFydFNjcm9sbFBvc2l0aW9uICsgc2Nyb2xsUmFuZ2U7XG4gICAgICBpZiAoYWxyZWFkeUluVmlldykge1xuICAgICAgICBpZiAodGhpcy5jb25maWcuX2xvZ0xldmVsID49IDIgfHwgKHRoaXMuY29uZmlnLl9sb2dMZXZlbCA+PSAxICYmIGlzRGV2TW9kZSgpKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdOb3Qgc2Nyb2xsaW5nLCBhcyB0YXJnZXQgYWxyZWFkeSBpbiB2aWV3Jyk7XG4gICAgICAgIH1cbiAgICAgICAgcGFnZVNjcm9sbEluc3RhbmNlLmZpcmVFdmVudCh0cnVlKTtcblxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUmVnaXN0ZXIgdGhlIGludGVycnVwdCBsaXN0ZW5lcnMgaWYgd2Ugd2FudCBhbiBpbnRlcnJ1cHRpYmxlIHNjcm9sbCBhbmltYXRpb25cbiAgICBpZiAocGFnZVNjcm9sbEluc3RhbmNlLnBhZ2VTY3JvbGxPcHRpb25zLmludGVycnVwdGlibGUpIHtcbiAgICAgIHBhZ2VTY3JvbGxJbnN0YW5jZS5hdHRhY2hJbnRlcnJ1cHRMaXN0ZW5lcnModGhpcy5vbkludGVycnVwdGVkKTtcbiAgICB9XG5cbiAgICAvLyBMZXQncyBnZXQgc3RhcnRlZCwgZ2V0IHRoZSBzdGFydCB0aW1lLi4uXG4gICAgcGFnZVNjcm9sbEluc3RhbmNlLnN0YXJ0VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIC8vIC4uIGFuZCBjYWxjdWxhdGUgdGhlIGVuZCB0aW1lICh3aGVuIHdlIG5lZWQgdG8gZmluaXNoIGF0IGxhc3QpXG4gICAgcGFnZVNjcm9sbEluc3RhbmNlLmVuZFRpbWUgPSBwYWdlU2Nyb2xsSW5zdGFuY2Uuc3RhcnRUaW1lICsgcGFnZVNjcm9sbEluc3RhbmNlLmV4ZWN1dGlvbkR1cmF0aW9uO1xuXG4gICAgcGFnZVNjcm9sbEluc3RhbmNlLnRpbWVyID0gc2V0SW50ZXJ2YWwoKF9wYWdlU2Nyb2xsSW5zdGFuY2U6IFBhZ2VTY3JvbGxJbnN0YW5jZSkgPT4ge1xuICAgICAgLy8gVGFrZSB0aGUgY3VycmVudCB0aW1lXG4gICAgICBjb25zdCBjdXJyZW50VGltZTogbnVtYmVyID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgICAgIC8vIERldGVybWluZSB0aGUgbmV3IHNjcm9sbCBwb3NpdGlvblxuICAgICAgbGV0IG5ld1Njcm9sbFBvc2l0aW9uOiBudW1iZXI7XG4gICAgICBsZXQgc3RvcE5vdyA9IGZhbHNlO1xuICAgICAgaWYgKF9wYWdlU2Nyb2xsSW5zdGFuY2UuZW5kVGltZSA8PSBjdXJyZW50VGltZSkge1xuICAgICAgICAvLyBXZSdyZSBvdmVyIHRoZSB0aW1lIGFscmVhZHksIHNvIGdvIHRoZSB0YXJnZXRTY3JvbGxQb3NpdGlvbiAoYWthIGRlc3RpbmF0aW9uKVxuICAgICAgICBuZXdTY3JvbGxQb3NpdGlvbiA9IF9wYWdlU2Nyb2xsSW5zdGFuY2UudGFyZ2V0U2Nyb2xsUG9zaXRpb247XG4gICAgICAgIHN0b3BOb3cgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBzY3JvbGwgcG9zaXRpb24gYmFzZWQgb24gdGhlIGN1cnJlbnQgdGltZSB1c2luZyB0aGUgZWFzaW5nIGZ1bmN0aW9uXG4gICAgICAgIG5ld1Njcm9sbFBvc2l0aW9uID0gTWF0aC5yb3VuZChfcGFnZVNjcm9sbEluc3RhbmNlLnBhZ2VTY3JvbGxPcHRpb25zLmVhc2luZ0xvZ2ljKFxuICAgICAgICAgIGN1cnJlbnRUaW1lIC0gX3BhZ2VTY3JvbGxJbnN0YW5jZS5zdGFydFRpbWUsXG4gICAgICAgICAgX3BhZ2VTY3JvbGxJbnN0YW5jZS5zdGFydFNjcm9sbFBvc2l0aW9uLFxuICAgICAgICAgIF9wYWdlU2Nyb2xsSW5zdGFuY2UuZGlzdGFuY2VUb1Njcm9sbCxcbiAgICAgICAgICBfcGFnZVNjcm9sbEluc3RhbmNlLmV4ZWN1dGlvbkR1cmF0aW9uKSk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5jb25maWcuX2xvZ0xldmVsID49IDUgJiYgaXNEZXZNb2RlKCkpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdTY3JvbGwgUG9zaXRpb246ICcgKyBuZXdTY3JvbGxQb3NpdGlvbik7XG4gICAgICB9XG4gICAgICAvLyBTZXQgdGhlIG5ldyBzY3JvbGxQb3NpdGlvbiB0byBhbGwgc2Nyb2xsVmlld3MgZWxlbWVudHNcbiAgICAgIGlmICghX3BhZ2VTY3JvbGxJbnN0YW5jZS5zZXRTY3JvbGxQb3NpdGlvbihuZXdTY3JvbGxQb3NpdGlvbikpIHtcbiAgICAgICAgLy8gU2V0dGluZyB0aGUgbmV3IHNjcm9sbFRvcC9zY3JvbGxMZWZ0IHZhbHVlIGZhaWxlZCBmb3IgYWxsIFNjcm9sbFZpZXdzXG4gICAgICAgIC8vIGVhcmx5IHN0b3AgdGhlIHNjcm9sbCBhbmltYXRpb24gdG8gc2F2ZSByZXNvdXJjZXNcbiAgICAgICAgc3RvcE5vdyA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIC8vIEF0IHRoZSBlbmQgZG8gdGhlIGludGVybmFsIHN0b3AgbWFpbnRlbmFuY2UgYW5kIGZpcmUgdGhlIHBhZ2VTY3JvbGxGaW5pc2ggZXZlbnRcbiAgICAgIC8vIChvdGhlcndpc2UgdGhlIGV2ZW50IG1pZ2h0IGFycml2ZSBhdCBcInRvbyBlYXJseVwiKVxuICAgICAgaWYgKHN0b3BOb3cpIHtcbiAgICAgICAgdGhpcy5zdG9wSW50ZXJuYWwoZmFsc2UsIF9wYWdlU2Nyb2xsSW5zdGFuY2UpO1xuICAgICAgfVxuXG4gICAgfSwgdGhpcy5jb25maWcuX2ludGVydmFsLCBwYWdlU2Nyb2xsSW5zdGFuY2UpO1xuXG4gICAgLy8gUmVnaXN0ZXIgdGhlIGluc3RhbmNlIGFzIHJ1bm5pbmcgb25lXG4gICAgdGhpcy5ydW5uaW5nSW5zdGFuY2VzLnB1c2gocGFnZVNjcm9sbEluc3RhbmNlKTtcbiAgfVxuXG4gIHB1YmxpYyBzY3JvbGwob3B0aW9uczogUGFnZVNjcm9sbE9wdGlvbnMpOiB2b2lkIHtcbiAgICB0aGlzLnN0YXJ0KHRoaXMuY3JlYXRlKG9wdGlvbnMpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wIGFsbCBydW5uaW5nIHNjcm9sbCBhbmltYXRpb25zLiBPcHRpb25hbGx5IGxpbWl0IHRvIHN0b3Agb25seSB0aGUgb25lcyBvZiBzcGVjaWZpYyBuYW1lc3BhY2UuXG4gICAqL1xuICBwdWJsaWMgc3RvcEFsbChuYW1lc3BhY2U/OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBpZiAodGhpcy5ydW5uaW5nSW5zdGFuY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBzdG9wcGVkU29tZSA9IGZhbHNlO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucnVubmluZ0luc3RhbmNlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICBjb25zdCBwYWdlU2Nyb2xsSW5zdGFuY2UgPSB0aGlzLnJ1bm5pbmdJbnN0YW5jZXNbaV07XG4gICAgICAgIGlmICghbmFtZXNwYWNlIHx8IHBhZ2VTY3JvbGxJbnN0YW5jZS5wYWdlU2Nyb2xsT3B0aW9ucy5uYW1lc3BhY2UgPT09IG5hbWVzcGFjZSkge1xuICAgICAgICAgIHN0b3BwZWRTb21lID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLnN0b3BJbnRlcm5hbCh0cnVlLCBwYWdlU2Nyb2xsSW5zdGFuY2UpO1xuICAgICAgICAgIC8vIERlY3JlYXNlIHRoZSBjb3VudGVyLCBhcyB3ZSByZW1vdmVkIGFuIGl0ZW0gZnJvbSB0aGUgYXJyYXkgd2UgaXRlcmF0ZSBvdmVyXG4gICAgICAgICAgaS0tO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBzdG9wcGVkU29tZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwdWJsaWMgc3RvcChwYWdlU2Nyb2xsSW5zdGFuY2U6IFBhZ2VTY3JvbGxJbnN0YW5jZSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnN0b3BJbnRlcm5hbCh0cnVlLCBwYWdlU2Nyb2xsSW5zdGFuY2UpO1xuICB9XG5cbiAgY29uc3RydWN0b3IoQEluamVjdChOR1hQU19DT05GSUcpIGN1c3RvbUNvbmZpZzogUGFnZVNjcm9sbENvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gey4uLmRlZmF1bHRQYWdlU2Nyb2xsQ29uZmlnLCAuLi5jdXN0b21Db25maWd9O1xuXG4gICAgaWYgKFBhZ2VTY3JvbGxTZXJ2aWNlLmluc3RhbmNlQ291bnRlciA+IDAgJiZcbiAgICAgICh0aGlzLmNvbmZpZy5fbG9nTGV2ZWwgPj0gMiB8fCAodGhpcy5jb25maWcuX2xvZ0xldmVsID49IDEgJiYgaXNEZXZNb2RlKCkpKSkge1xuICAgICAgY29uc29sZS53YXJuKCdBbiBpbnN0YW5jZSBvZiBQYWdlU2Nyb2xsU2VydmljZSBhbHJlYWR5IGV4aXN0cywgdXN1YWxseSAnICtcbiAgICAgICAgJ2luY2x1ZGluZyBvbmUgcHJvdmlkZXIgc2hvdWxkIGJlIGVub3VnaCwgc28gZG91YmxlIGNoZWNrLicpO1xuICAgIH1cbiAgICBQYWdlU2Nyb2xsU2VydmljZS5pbnN0YW5jZUNvdW50ZXIrKztcbiAgfVxufVxuIl19